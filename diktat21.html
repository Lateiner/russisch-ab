<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏–∫—Ç–∞–Ω—Ç: –ü–æ—á–µ–º—É?</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3f51b5;
            --primary-light: #c5cae9;
            --secondary: #ff4081;
            --success: #4caf50;
            --error: #f44336;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            padding-bottom: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .container {
            width: 100%;
            max-width: 800px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary-light);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            border: none;
            border-radius: 6px;
            padding: 8px 14px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            background: #eee;
        }

        button:hover { filter: brightness(0.9); }
        button:active { transform: scale(0.95); }

        .btn-audio { background-color: var(--primary); color: white; }
        .btn-solution { background-color: #fb8c00; color: white; }
        .btn-translate { background-color: #78909c; color: white; }
        .btn-reset { background: #f5f5f5; color: #333; }

        .translation {
            display: none;
            font-style: italic;
            color: #555;
            margin-bottom: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .input-container {
            position: relative;
            min-height: 50px;
        }

        .backdrop, .main-input {
            width: 100%;
            min-height: 50px;
            font-size: 18px;
            line-height: 1.6;
            padding: 12px;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            white-space: pre-wrap;
            word-wrap: break-word;
            border-radius: 8px;
        }

        .backdrop {
            position: absolute;
            top: 0;
            left: 0;
            background-color: #fff;
            color: transparent;
            z-index: 1;
            border: 1px solid transparent;
            pointer-events: none;
        }

        .main-input {
            position: relative;
            z-index: 2;
            background: transparent;
            border: 1px solid #ddd;
            color: #333;
            caret-color: #333;
            outline: none;
            resize: none;
            overflow: hidden;
        }

        .main-input:focus { border-color: var(--primary); }

        .correct { background-color: rgba(76, 175, 80, 0.25); color: transparent; }
        .wrong { background-color: rgba(244, 67, 54, 0.25); color: transparent; }

        #keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #d1d4d9;
            padding: 10px 5px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.15);
            display: none;
            flex-direction: column;
            gap: 6px;
            z-index: 1000;
            user-select: none;
        }

        .kb-row { display: flex; justify-content: center; gap: 4px; }

        .key {
            background: white;
            border-radius: 5px;
            padding: 12px 0;
            min-width: 38px;
            text-align: center;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: background 0.1s;
        }

        .key:active { background: #abb2bf; }
        .key.wide { flex-grow: 1; max-width: 100px; font-size: 14px; background: #abb2bf; }
        .key.space { width: 40%; background: white; }
        .key.active-shift { background: var(--primary); color: white; }

        #toggle-kb-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            font-size: 24px;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<header>
    <h1>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏–∫—Ç–∞–Ω—Ç</h1>
    <p>–ù–∞–ø–∏—à–∏—Ç–µ —Ç–æ, —á—Ç–æ —Å–ª—ã—à–∏—Ç–µ. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–µ–±—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
</header>

<div class="container" id="app"></div>

<button id="toggle-kb-btn" onclick="toggleKeyboard()">‚å®Ô∏è</button>

<div id="keyboard"></div>

<script>
    const sentences = [
        { ru: "–ü–æ—á–µ–º—É?", de: "Warum?" },
        { ru: "–ü–æ—á–µ–º—É —É –º–æ–µ–π –º–ª–∞–¥—à–µ–π —Å–µ—Å—Ç—Ä—ã –ö—Ä–∏—Å—Ç–∏–Ω—ã –Ω–µ—Ç —Å–≤–æ–µ–≥–æ –Ω–æ—É—Ç–±—É–∫–∞?", de: "Warum hat meine j√ºngere Schwester Kristina keinen eigenen Laptop?" },
        { ru: "–ü–æ—ç—Ç–æ–º—É –æ–Ω–∞ —á–∞—Å—Ç–æ –ø—Ä–æ—Å–∏—Ç –º–µ–Ω—è –¥–∞—Ç—å –µ–π –º–æ–π –Ω–æ—É—Ç–±—É–∫.", de: "Deshalb bittet sie mich oft, ihr meinen Laptop zu geben." },
        { ru: "–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é, –ø–æ—á–µ–º—É –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π —à–∫–æ–ª–µ —É –¥–µ—Ç–µ–π —Ç–∞–∫ –º–Ω–æ–≥–æ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è?", de: "Ich verstehe nicht, warum Kinder in der Grundschule so viele Hausaufgaben haben?" },
        { ru: "–ò–º –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –ø–∏—Å–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Ä–µ—Ñ–µ—Ä–∞—Ç—ã, –∏—Å–∫–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, —á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç—å–∏ –ø–æ –±–∏–æ–ª–æ–≥–∏–∏, –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏–∏.", de: "Sie m√ºssen Pr√§sentationen erstellen, lange Referate schreiben, sch√∂ne Bilder und Fotos suchen, Artikel √ºber Biologie, Geografie und Geschichte lesen." },
        { ru: "–ù–∞—à–∏ –º–∞–º–∞ –∏ –ø–∞–ø–∞ –≤—Å–µ–≥–¥–∞ –º–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–∞—é—Ç, —É –Ω–∏—Ö –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.", de: "Unsere Mama und unser Papa arbeiten immer viel, sie haben keine Freizeit." },
        { ru: "–ö–æ–≥–¥–∞ –ö—Ä–∏—Å—Ç–∏–Ω–∞ –ø—Ä–æ—Å–∏—Ç –∏—Ö –ø–æ–º–æ—á—å, –æ–Ω–∏ –∑–æ–≤—É—Ç –º–µ–Ω—è.", de: "Wenn Kristina sie um Hilfe bittet, rufen sie mich." },
        { ru: "–í—á–µ—Ä–∞ –ö—Ä–∏—Å—Ç–∏–Ω–µ –¥–∞–ª–∏ –∑–∞–¥–∞–Ω–∏–µ: –Ω–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É–ª–∏—Ü–∞—Ö –Ω–∞—à–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –Ω–∞ —É—Ä–æ–∫–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –æ–¥–Ω–æ–π —É–ª–∏—Ü—ã.", de: "Gestern bekam Kristina die Aufgabe: im Internet Informationen √ºber die Stra√üen unserer Stadt zu finden und im Unterricht eine interessante Geschichte √ºber eine Stra√üe zu erz√§hlen." },
        { ru: "–°–µ–π—á–∞—Å –º—ã –∂–∏–≤—ë–º –≤ –ú–æ—Å–∫–≤–µ, –Ω–æ –º—ã —Å –ö—Ä–∏—Å—Ç–∏–Ω–æ–π —Ä–æ–¥–∏–ª–∏—Å—å –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ.", de: "Jetzt leben wir in Moskau, aber wir (Kristina und ich) sind in Sankt Petersburg geboren." },
        { ru: "–ö—Ä–∏—Å—Ç–∏–Ω–∞ –æ—á–µ–Ω—å —Ö–æ—Ç–µ–ª–∞ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Ä–æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ, –Ω–æ —É—á–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ —Å–∫–∞–∑–∞–ª–∞, —á—Ç–æ —É—Ä–æ–∫ –±—É–¥–µ—Ç –æ–± —É–ª–∏—Ü–∞—Ö –ú–æ—Å–∫–≤—ã, –∏ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —É–ª–∏—Ü—É –≤ –ú–æ—Å–∫–≤–µ.", de: "Kristina wollte unbedingt √ºber ihre Heimatstadt erz√§hlen, aber die Lehrerin sagte, dass die Stunde √ºber die Stra√üen Moskaus sein wird und man eine Stra√üe in Moskau w√§hlen muss." },
        { ru: "–Ø –æ—Ç–∫—Ä—ã–ª –Ω–æ—É—Ç–±—É–∫, –∏ –º—ã –Ω–∞—à–ª–∏ —Å–∞–π—Ç –≥–æ—Ä–æ–¥–∞, –≥–¥–µ –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –Ω–∞–∑–≤–∞–Ω–∏–π —É–ª–∏—Ü.", de: "Ich √∂ffnete den Laptop und wir fanden die Website der Stadt, auf der man die Geschichte der Stra√üennamen erfahren kann." },
        { ru: "–ö–æ–≥–¥–∞ —è –µ–∑–∂—É –≤ —à–∫–æ–ª—É, —è –≤—Å–µ–≥–¥–∞ –∏–¥—É –æ—Ç –º–µ—Ç—Ä–æ –¥–æ —à–∫–æ–ª—ã –ø–æ —É–ª–∏—Ü–µ –ú—è—Å–Ω–∏—Ü–∫–∞—è.", de: "Wenn ich zur Schule fahre, gehe ich immer von der Metro bis zur Schule durch die Mjasnizkaja-Stra√üe." },
        { ru: "–ü–æ—ç—Ç–æ–º—É —è –ø—Ä–µ–¥–ª–æ–∂–∏–ª —É–∑–Ω–∞—Ç—å –æ–± —ç—Ç–æ–π —É–ª–∏—Ü–µ.", de: "Deshalb schlug ich vor, etwas √ºber diese Stra√üe herauszufinden." },
        { ru: "–í –ø–µ—Ä–≤–æ–º –∫–ª–∞—Å—Å–µ –ö—Ä–∏—Å—Ç–∏–Ω–∞ —Ç–æ–∂–µ —É—á–∏–ª–∞—Å—å –≤ —ç—Ç–æ–π —à–∫–æ–ª–µ, –ø–æ—ç—Ç–æ–º—É –µ–π –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å –º–æ—è –∏–¥–µ—è.", de: "In der ersten Klasse war Kristina auch auf dieser Schule, deshalb gefiel ihr meine Idee." }
    ];

    let activeInput = null;
    let isShift = false;

    const app = document.getElementById('app');
    sentences.forEach((s, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div class="controls">
                <button class="btn-audio" onclick="speak('${s.ru.replace(/'/g, "\\'")}')">üîä –ü—Ä–æ—Å–ª—É—à–∞—Ç—å</button>
                <button class="btn-translate" onclick="toggleVisibility('trans-${idx}')">üåê –ü–µ—Ä–µ–≤–æ–¥</button>
                <button class="btn-solution" onclick="showSolution(${idx})">üëÅÔ∏è –û—Ç–≤–µ—Ç</button>
                <button class="btn-reset" onclick="reset(${idx})">üîÑ –°–±—Ä–æ—Å</button>
            </div>
            <div id="trans-${idx}" class="translation">${s.de}</div>
            <div class="input-container">
                <div id="back-${idx}" class="backdrop"></div>
                <textarea id="in-${idx}" class="main-input" 
                    oninput="validate(${idx})" 
                    onfocus="activeInput = this"
                    placeholder="–ù–∞–±–µ—Ä–∏—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
            </div>
        `;
        app.appendChild(card);
    });

    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'ru-RU';
        msg.rate = 0.6; // Langsamer f√ºr Diktate
        msg.pitch = 1.0; // Tonlage bleibt gleich
        window.speechSynthesis.speak(msg);
    }

    function validate(idx) {
        const input = document.getElementById(`in-${idx}`);
        const backdrop = document.getElementById(`back-${idx}`);
        const target = sentences[idx].ru;
        const current = input.value;
        
        input.style.height = 'auto';
        input.style.height = input.scrollHeight + 'px';
        backdrop.style.height = input.style.height;

        let html = '';
        for (let i = 0; i < current.length; i++) {
            if (i >= target.length) {
                html += `<span class="wrong">${current[i]}</span>`;
            } else if (current[i] === target[i]) {
                html += `<span class="correct">${current[i]}</span>`;
            } else {
                html += `<span class="wrong">${current[i]}</span>`;
            }
        }
        backdrop.innerHTML = html;
    }

    function showSolution(idx) {
        document.getElementById(`in-${idx}`).value = sentences[idx].ru;
        validate(idx);
    }

    function reset(idx) {
        document.getElementById(`in-${idx}`).value = '';
        validate(idx);
    }

    function toggleVisibility(id) {
        const el = document.getElementById(id);
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    const kbLayout = {
        normal: [
            ["–π", "—Ü", "—É", "–∫", "–µ", "–Ω", "–≥", "—à", "—â", "–∑", "—Ö", "—ä"],
            ["—Ñ", "—ã", "–≤", "–∞", "–ø", "—Ä", "–æ", "–ª", "–¥", "–∂", "—ç"],
            ["Shift", "—è", "—á", "—Å", "–º", "–∏", "—Ç", "—å", "–±", "—é", "."],
            ["Backspace", " ", "?", "Hide"]
        ],
        shift: [
            ["–ô", "–¶", "–£", "–ö", "–ï", "–ù", "–ì", "–®", "–©", "–ó", "–•", "–™"],
            ["–§", "–´", "–í", "–ê", "–ü", "–†", "–û", "–õ", "–î", "–ñ", "–≠"],
            ["Shift", "–Ø", "–ß", "–°", "–ú", "–ò", "–¢", "–¨", "–ë", "–Æ", ","],
            ["Backspace", " ", "!", "Hide"]
        ]
    };

    function renderKeyboard() {
        const kb = document.getElementById('keyboard');
        kb.innerHTML = '';
        const layout = isShift ? kbLayout.shift : kbLayout.normal;

        layout.forEach(row => {
            const rowEl = document.createElement('div');
            rowEl.className = 'kb-row';
            row.forEach(key => {
                const keyEl = document.createElement('div');
                keyEl.className = 'key';
                if (key === 'Shift') {
                    keyEl.classList.add('wide');
                    if(isShift) keyEl.classList.add('active-shift');
                }
                if (key === 'Backspace' || key === 'Hide') keyEl.classList.add('wide');
                if (key === ' ') keyEl.classList.add('space');
                
                keyEl.textContent = key === ' ' ? '–ü—Ä–æ–±–µ–ª' : key;
                
                keyEl.onmousedown = (e) => {
                    e.preventDefault();
                    handleKey(key);
                };
                rowEl.appendChild(keyEl);
            });
            kb.appendChild(rowEl);
        });
    }

    function handleKey(key) {
        if (key === 'Hide') { toggleKeyboard(); return; }
        if (key === 'Shift') { isShift = !isShift; renderKeyboard(); return; }
        if (!activeInput) return;

        const start = activeInput.selectionStart;
        const end = activeInput.selectionEnd;
        let val = activeInput.value;

        if (key === 'Backspace') {
            activeInput.value = val.slice(0, start === end ? start - 1 : start) + val.slice(end);
            activeInput.selectionStart = activeInput.selectionEnd = start - (start === end ? 1 : 0);
        } else {
            activeInput.value = val.slice(0, start) + key + val.slice(end);
            activeInput.selectionStart = activeInput.selectionEnd = start + key.length;
        }

        const idx = activeInput.id.split('-')[1];
        validate(idx);
        
        if (isShift && key !== 'Backspace') {
            isShift = false;
            renderKeyboard();
        }
    }

    function toggleKeyboard() {
        const kb = document.getElementById('keyboard');
        kb.style.display = kb.style.display === 'flex' ? 'none' : 'flex';
    }

    renderKeyboard();
</script>

</body>
</html>